{
  "type": "Program",
  "nodes": [
    {
      "type": "Node",
      "id": "start",
      "statements": [
        {
          "type": "Say",
          "text": "Welcome to the adventure!",
          "interpolations": [],
          "line": 3,
          "column": 3
        },
        {
          "type": "Say",
          "text": "You have #{...} gold and #{...} HP.",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "gold"
              },
              "start": 9,
              "end": 9
            },
            {
              "expression": {
                "type": "Variable",
                "name": "health"
              },
              "start": 25,
              "end": 25
            }
          ],
          "line": 4,
          "column": 3
        },
        {
          "type": "Assignment",
          "variable": "visited_start",
          "operator": "=",
          "value": {
            "type": "Literal",
            "value": true
          },
          "line": 6,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "visit_count",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "+",
            "left": {
              "type": "Variable",
              "name": "visit_count"
            },
            "right": {
              "type": "Literal",
              "value": 1
            }
          },
          "line": 7,
          "column": 4
        },
        {
          "type": "Choice",
          "text": "Go to shop",
          "target": "shop",
          "line": 9,
          "column": 11
        },
        {
          "type": "Choice",
          "text": "Go to forest",
          "target": "forest",
          "line": 10,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "right": {
              "type": "Literal",
              "value": 5
            },
            "left": {
              "type": "Variable",
              "name": "level"
            },
            "operator": ">="
          }
        },
        {
          "type": "Choice",
          "text": "Rest at inn",
          "target": "inn",
          "line": 11,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "operator": "&&",
            "left": {
              "type": "BinaryOp",
              "right": {
                "type": "Literal",
                "value": 20
              },
              "left": {
                "type": "Variable",
                "name": "gold"
              },
              "operator": ">="
            },
            "right": {
              "type": "BinaryOp",
              "right": {
                "type": "Literal",
                "value": 100
              },
              "left": {
                "type": "Variable",
                "name": "health"
              },
              "operator": "<"
            }
          }
        },
        {
          "type": "Choice",
          "text": "Check inventory",
          "target": "inventory",
          "line": 12,
          "column": 11,
          "condition": {
            "type": "UnaryOp",
            "operator": "!",
            "operand": {
              "type": "Variable",
              "name": "inventory_empty"
            }
          }
        },
        {
          "type": "Choice",
          "text": "Quit",
          "target": "ending",
          "line": 13,
          "column": 11
        }
      ],
      "line": 2,
      "column": 7
    },
    {
      "type": "Node",
      "id": "shop",
      "statements": [
        {
          "type": "Say",
          "text": "Welcome to my shop!",
          "interpolations": [],
          "line": 17,
          "column": 3
        },
        {
          "type": "Say",
          "text": "I have potions for 50 gold.",
          "interpolations": [],
          "line": 18,
          "column": 3
        },
        {
          "type": "Choice",
          "text": "Buy potion",
          "target": "buy_potion",
          "line": 20,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "right": {
              "type": "Literal",
              "value": 50
            },
            "left": {
              "type": "Variable",
              "name": "gold"
            },
            "operator": ">="
          }
        },
        {
          "type": "Choice",
          "text": "Sell items",
          "target": "sell_items",
          "line": 21,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "right": {
              "type": "Literal",
              "value": true
            },
            "left": {
              "type": "Variable",
              "name": "has_items"
            },
            "operator": "=="
          }
        },
        {
          "type": "Choice",
          "text": "Leave",
          "target": "start",
          "line": 22,
          "column": 11
        }
      ],
      "line": 16,
      "column": 6
    },
    {
      "type": "Node",
      "id": "empty",
      "statements": [],
      "line": 25,
      "column": 6
    },
    {
      "type": "Node",
      "id": "buy_potion",
      "statements": [
        {
          "type": "Assignment",
          "variable": "gold",
          "operator": "-=",
          "value": {
            "type": "Literal",
            "value": 50
          },
          "line": 29,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "health",
          "operator": "+=",
          "value": {
            "type": "Literal",
            "value": 30
          },
          "line": 30,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "potions",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "+",
            "left": {
              "type": "Variable",
              "name": "potions"
            },
            "right": {
              "type": "Literal",
              "value": 1
            }
          },
          "line": 31,
          "column": 4
        },
        {
          "type": "Say",
          "text": "You bought a potion!",
          "interpolations": [],
          "line": 33,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Health restored to #{...}.",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "health"
              },
              "start": 19,
              "end": 19
            }
          ],
          "line": 34,
          "column": 3
        },
        {
          "type": "Goto",
          "target": "shop",
          "line": 36,
          "column": 3
        }
      ],
      "line": 28,
      "column": 6
    },
    {
      "type": "Node",
      "id": "sell_items",
      "statements": [
        {
          "type": "Assignment",
          "variable": "gold",
          "operator": "+=",
          "value": {
            "type": "FunctionCall",
            "name": "random",
            "args": [
              {
                "type": "Literal",
                "value": 10
              },
              {
                "type": "Literal",
                "value": 50
              }
            ]
          },
          "line": 40,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "has_items",
          "operator": "=",
          "value": {
            "type": "Literal",
            "value": false
          },
          "line": 41,
          "column": 4
        },
        {
          "type": "Say",
          "text": "You sold your items for #{...} gold.",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "gold"
              },
              "start": 24,
              "end": 24
            }
          ],
          "line": 43,
          "column": 3
        },
        {
          "type": "Choice",
          "text": "Continue shopping",
          "target": "shop",
          "line": 45,
          "column": 11
        },
        {
          "type": "Choice",
          "text": "Leave",
          "target": "start",
          "line": 46,
          "column": 11
        }
      ],
      "line": 39,
      "column": 6
    },
    {
      "type": "Node",
      "id": "forest",
      "statements": [
        {
          "type": "Say",
          "text": "You enter the dark forest...",
          "interpolations": [],
          "line": 50,
          "column": 3
        },
        {
          "type": "Assignment",
          "variable": "enemy_hp",
          "operator": "=",
          "value": {
            "type": "FunctionCall",
            "name": "random",
            "args": [
              {
                "type": "Literal",
                "value": 20
              },
              {
                "type": "Literal",
                "value": 50
              }
            ]
          },
          "line": 52,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "damage",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "*",
            "left": {
              "type": "Variable",
              "name": "strength"
            },
            "right": {
              "type": "Literal",
              "value": 2
            }
          },
          "line": 53,
          "column": 4
        },
        {
          "type": "Choice",
          "text": "Attack",
          "target": "battle",
          "line": 55,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "right": {
              "type": "Literal",
              "value": 0
            },
            "left": {
              "type": "Variable",
              "name": "enemy_hp"
            },
            "operator": ">"
          }
        },
        {
          "type": "Choice",
          "text": "Run away",
          "target": "start",
          "line": 56,
          "column": 11
        }
      ],
      "line": 49,
      "column": 6
    },
    {
      "type": "Node",
      "id": "battle",
      "statements": [
        {
          "type": "Assignment",
          "variable": "enemy_hp",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "-",
            "left": {
              "type": "Variable",
              "name": "enemy_hp"
            },
            "right": {
              "type": "Variable",
              "name": "damage"
            }
          },
          "line": 60,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "health",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "-",
            "left": {
              "type": "Variable",
              "name": "health"
            },
            "right": {
              "type": "FunctionCall",
              "name": "random",
              "args": [
                {
                  "type": "Literal",
                  "value": 5
                },
                {
                  "type": "Literal",
                  "value": 15
                }
              ]
            }
          },
          "line": 61,
          "column": 4
        },
        {
          "type": "Say",
          "text": "You deal #{...} damage!",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "damage"
              },
              "start": 9,
              "end": 9
            }
          ],
          "line": 63,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Enemy HP: #{...}",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "enemy_hp"
              },
              "start": 10,
              "end": 10
            }
          ],
          "line": 64,
          "column": 3
        },
        {
          "type": "Choice",
          "text": "Continue fighting",
          "target": "battle",
          "line": 66,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "operator": "&&",
            "left": {
              "type": "BinaryOp",
              "right": {
                "type": "Literal",
                "value": 0
              },
              "left": {
                "type": "Variable",
                "name": "enemy_hp"
              },
              "operator": ">"
            },
            "right": {
              "type": "BinaryOp",
              "right": {
                "type": "Literal",
                "value": 0
              },
              "left": {
                "type": "Variable",
                "name": "health"
              },
              "operator": ">"
            }
          }
        },
        {
          "type": "Choice",
          "text": "Victory!",
          "target": "victory",
          "line": 67,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "right": {
              "type": "Literal",
              "value": 0
            },
            "left": {
              "type": "Variable",
              "name": "enemy_hp"
            },
            "operator": "<="
          }
        },
        {
          "type": "Choice",
          "text": "Defeat...",
          "target": "defeat",
          "line": 68,
          "column": 11,
          "condition": {
            "type": "BinaryOp",
            "right": {
              "type": "Literal",
              "value": 0
            },
            "left": {
              "type": "Variable",
              "name": "health"
            },
            "operator": "<="
          }
        }
      ],
      "line": 59,
      "column": 6
    },
    {
      "type": "Node",
      "id": "victory",
      "statements": [
        {
          "type": "Assignment",
          "variable": "gold",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "+",
            "left": {
              "type": "Variable",
              "name": "gold"
            },
            "right": {
              "type": "FunctionCall",
              "name": "random",
              "args": [
                {
                  "type": "Literal",
                  "value": 50
                },
                {
                  "type": "Literal",
                  "value": 100
                }
              ]
            }
          },
          "line": 72,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "xp",
          "operator": "+=",
          "value": {
            "type": "Literal",
            "value": 100
          },
          "line": 73,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "level",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "+",
            "left": {
              "type": "Variable",
              "name": "level"
            },
            "right": {
              "type": "Literal",
              "value": 1
            }
          },
          "line": 74,
          "column": 4
        },
        {
          "type": "Say",
          "text": "You won the battle!",
          "interpolations": [],
          "line": 76,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Gained #{...} gold and leveled up!",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "gold"
              },
              "start": 7,
              "end": 7
            }
          ],
          "line": 77,
          "column": 3
        },
        {
          "type": "Goto",
          "target": "start",
          "line": 79,
          "column": 3
        }
      ],
      "line": 71,
      "column": 6
    },
    {
      "type": "Node",
      "id": "defeat",
      "statements": [
        {
          "type": "Say",
          "text": "You were defeated...",
          "interpolations": [],
          "line": 83,
          "column": 3
        },
        {
          "type": "Assignment",
          "variable": "health",
          "operator": "=",
          "value": {
            "type": "Literal",
            "value": 100
          },
          "line": 84,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "gold",
          "operator": "=",
          "value": {
            "type": "BinaryOp",
            "operator": "/",
            "left": {
              "type": "Variable",
              "name": "gold"
            },
            "right": {
              "type": "Literal",
              "value": 2
            }
          },
          "line": 85,
          "column": 4
        },
        {
          "type": "Goto",
          "target": "start",
          "line": 87,
          "column": 3
        }
      ],
      "line": 82,
      "column": 6
    },
    {
      "type": "Node",
      "id": "inn",
      "statements": [
        {
          "type": "Assignment",
          "variable": "gold",
          "operator": "-=",
          "value": {
            "type": "Literal",
            "value": 20
          },
          "line": 91,
          "column": 4
        },
        {
          "type": "Assignment",
          "variable": "health",
          "operator": "=",
          "value": {
            "type": "Literal",
            "value": 100
          },
          "line": 92,
          "column": 4
        },
        {
          "type": "Say",
          "text": "You rest at the inn.",
          "interpolations": [],
          "line": 94,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Health fully restored!",
          "interpolations": [],
          "line": 95,
          "column": 3
        },
        {
          "type": "Goto",
          "target": "start",
          "line": 97,
          "column": 3
        }
      ],
      "line": 90,
      "column": 6
    },
    {
      "type": "Node",
      "id": "inventory",
      "statements": [
        {
          "type": "Say",
          "text": "Your inventory:",
          "interpolations": [],
          "line": 101,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Gold: #{...}",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "gold"
              },
              "start": 6,
              "end": 6
            }
          ],
          "line": 102,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Potions: #{...}",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "potions"
              },
              "start": 9,
              "end": 9
            }
          ],
          "line": 103,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Level: #{...}",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "level"
              },
              "start": 7,
              "end": 7
            }
          ],
          "line": 104,
          "column": 3
        },
        {
          "type": "Choice",
          "text": "Back",
          "target": "start",
          "line": 106,
          "column": 11
        }
      ],
      "line": 100,
      "column": 6
    },
    {
      "type": "Node",
      "id": "ending",
      "statements": [
        {
          "type": "Say",
          "text": "Thanks for playing!",
          "interpolations": [],
          "line": 110,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Final stats:",
          "interpolations": [],
          "line": 111,
          "column": 3
        },
        {
          "type": "Say",
          "text": "Gold: #{...}, Level: #{...}",
          "interpolations": [
            {
              "expression": {
                "type": "Variable",
                "name": "gold"
              },
              "start": 6,
              "end": 6
            },
            {
              "expression": {
                "type": "Variable",
                "name": "level"
              },
              "start": 21,
              "end": 21
            }
          ],
          "line": 112,
          "column": 3
        }
      ],
      "line": 109,
      "column": 6
    }
  ]
}